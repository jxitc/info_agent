# Android Client Testing Guide

## End-to-End Testing Workflow

This guide provides step-by-step instructions for testing the Android InfoAgent client with the backend server.

## Prerequisites

1. **InfoAgent Server Running**
   ```bash
   cd /Users/xjiang/info_agent
   source venv/bin/activate
   python -m info_agent.api.app
   ```
   Server should be accessible at http://localhost:8000

2. **Android Studio Setup**
   - Android Studio with emulator or physical device
   - Project built successfully (Run → Build Project)

## Test Scenarios

### Scenario 1: Server Health Check (Manual)

**From host machine:**
```bash
curl http://localhost:8000/health
# Expected: {"service": "info-agent-api", "status": "healthy", "version": "0.1.0"}
```

### Scenario 2: Memory Creation API Test (Manual)

**Test memory creation endpoint:**
```bash
curl -X POST http://localhost:8000/api/v1/memories \
  -H "Content-Type: application/json" \
  -d '{"content": "Test memory from API", "source_type": "MANUAL"}'
```

**Expected Response:**
```json
{
  "data": {
    "content": "Test memory from API",
    "created_at": "2025-09-13T23:17:27.173374Z",
    "dynamic_fields": {
      "ai_model": "gpt-3.5-turbo-0125",
      "ai_processed": true,
      "ai_tokens_used": 554,
      "categories": ["work"],
      "title": "Generated by AI"
    },
    "id": 34,
    "title": "AI-generated title",
    "word_count": 5
  },
  "message": "Memory created successfully",
  "success": true
}
```

### Scenario 3: Android Client Testing

#### Step 1: Launch Android App
1. Open Android Studio
2. Start emulator (Pixel 7 API 34 or similar)
3. Run app (Shift + F10)

#### Step 2: Test Settings Screen
1. Tap Settings icon (gear) in memory list screen
2. Verify default server URL shows: `http://10.0.2.2:8000`
3. Tap "Test Connection" button
4. **Expected:** Green checkmark with "Connected successfully"
5. **If failed:** Red X with error message

#### Step 3: Test Memory Creation
1. Navigate back to memory list (< back arrow)
2. Tap "Add Memory" button (+)
3. Enter test content: `"Meeting with team about project planning"`
4. Tap "Submit" button
5. **Expected behaviors:**
   - Loading spinner appears
   - Success message: "Memory created successfully"
   - Navigate back to memory list automatically
   - New memory appears in the list with AI-generated title

#### Step 4: Verify Server Sync
1. Check memory list shows the new memory
2. Memory should display:
   - AI-generated title (not the raw content)
   - Source type: "MANUAL"
   - Creation timestamp
   - No "Pending upload" indicator (successfully synced)

#### Step 5: Test Offline Behavior
1. Turn off WiFi on emulator (Extended Controls → Cellular → Data OFF)
2. Try creating another memory: `"Offline test memory"`
3. **Expected:**
   - Memory saves locally
   - Shows "Pending upload" indicator
   - Appears in memory list immediately
4. Turn WiFi back on
5. **Expected:** "Pending upload" should disappear after sync

## Validation Checklist

### ✅ Network Configuration
- [ ] Server accessible at localhost:8000
- [ ] Android network security config allows HTTP to 10.0.2.2
- [ ] INTERNET permission in AndroidManifest.xml

### ✅ UI Functionality  
- [ ] Memory list loads without crashes
- [ ] Add memory screen accepts input
- [ ] Settings screen allows server URL configuration
- [ ] Navigation between screens works

### ✅ Server Integration
- [ ] Connection test passes in settings
- [ ] Memory submission creates server record
- [ ] AI processing generates title and dynamic fields
- [ ] Local database stores memory with upload status

### ✅ Error Handling
- [ ] Network errors show user-friendly messages
- [ ] Offline mode saves memories locally
- [ ] Invalid server URLs handled gracefully
- [ ] App doesn't crash on server timeouts

## Common Issues & Solutions

### Issue: "Not permitted by network security policy"
**Solution:** Verify network_security_config.xml includes:
```xml
<domain includeSubdomains="false">10.0.2.2</domain>
```

### Issue: Connection test fails with "Connection refused"
**Solutions:**
1. Ensure InfoAgent server is running
2. Check server logs for errors
3. Try `curl http://localhost:8000/health` from host
4. Verify emulator can access internet

### Issue: Memory creation hangs
**Possible causes:**
1. OpenAI API key not configured
2. Server database connection issues  
3. Network timeout (increase timeout in Retrofit)

### Issue: AI processing fails
**Check server logs for:**
1. OpenAI API authentication errors
2. Token limit exceeded
3. Model unavailable

## Production Deployment Notes

**⚠️ CRITICAL:** Current setup uses HTTP which is only suitable for development.

For production deployment:
1. Configure HTTPS/TLS certificates
2. Remove HTTP allowlist from network security config
3. Update server URL to use proper domain with SSL
4. Implement certificate pinning for security

See `tasks.md` section 10.3 for production security requirements.

---

*This testing guide validates the complete Android → Server → AI processing → Database workflow.*